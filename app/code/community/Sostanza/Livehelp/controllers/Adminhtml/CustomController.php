<?php/** * Sostanza LiveHelp速 chat * * NOTICE OF LICENSE * * This source file is subject to the Open Software License (OSL 3.0) * that is bundled with this package in the file LICENSE.txt. * It is also available through the world-wide-web at this URL: * http://opensource.org/licenses/osl-3.0.php * If you did not receive a copy of the license and are unable to * obtain it through the world-wide-web, please send an email * to info@sostanza.it so we can send you a copy immediately. * * @category    Sostanza * @package     Sostanza_LiveHelp * @copyright   Copyright 2014 Sostanza s.r.l (http://www.sostanza.it) * @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0) */?><? class Sostanza_Livehelp_Adminhtml_CustomController extends Mage_Adminhtml_Controller_Action{private $query;    public function indexAction()    {        $this->loadLayout()            ->_setActiveMenu('mycustomtab')            ->_title($this->__('Index Action'));  $key = Mage::helper("adminhtml")->getUrl("adminhtml/widget_instance/"); $url = '/index.php/admin/widget_instance/index/key/'.$key;	 $this->getResponse()->setRedirect($url);        $this->renderLayout();    }     public function listAction()    {        $this->loadLayout()            ->_setActiveMenu('mycustomtab')            ->_title($this->__('List Action'));       //$url = 'http://server.livehelp.it/admin/main.asp';       // $this->getResponse()->setRedirect($url); $key = Mage::helper("adminhtml")->getUrl("adminhtml/custom/chat"); $url = '/index.php/admin/custom/chat/key/'.$key;  $this->getResponse()->setRedirect($url);        $this->renderLayout();    }    public function aboutAction()    {         $this->loadLayout()            ->_setActiveMenu('mycustomtab')            ->_title($this->__('About Action'));     /*  $url = "<script type='text/javascript'>window.open('http://www.livehelp.it/vedit/pagina.asp?pagina=1395')</script>";	   echo $url;       // $this->getResponse()->setRedirect('http://magentogiulia.ilbello.com/index.php/admin');	   $key2 = Mage::helper("adminhtml")->getUrl("adminhtml/widget_instance/"); $url2 = '/index.php/admin/widget_instance/index/key/'.$key2;*/ $key = Mage::helper("adminhtml")->getUrl("adminhtml/custom/chat"); $url = '/index.php/admin/custom/chat/key/'.$key;  $this->getResponse()->setRedirect($url);   //$this->loadLayout();        $this->renderLayout();    }		    public function chatAction()    {$resource = Mage::getSingleton('core/resource');         /**     * Retrieve the read connection     */    $readConnection = $resource->getConnection('core_read');     /**     * Retrieve our table name     */    	     $query =$readConnection->query( "SELECT * FROM widget_instance ORDER BY instance_id desc");    //$sku = $readConnection->fetchOne($query);     while ($row = $query->fetch() ) {$verifica[]= strstr ($row['widget_parameters'], 'sostanza_livehelpID');}$id = implode(',', $verifica);        $this->loadLayout()            ->_setActiveMenu('mycustomtab')            ->_title($this->__('Chat Action'));		$pattern="/[0-9]{5}/";		preg_match('/[0-9]{5}/', $id, $matches);		$url = 'http://server.livehelp.it/mobile/?id='.$matches[0];					/*$block = $this->getLayout()        ->createBlock('core/text', 'example-block')        ->setText('clicca <a href="'.$url.'" target="blank">qui</a> per chattare<br/>');		$this->_addContent($block);				$block2 = $this->getLayout()        ->createBlock('core/text', 'example-block2')        ->setText('clicca <a href="http://server.livehelp.it/admin/main.asp" target="blank">qui</a> per amministrare il tuo account<br/>');		$this->_addContent($block2);				$block3 = $this->getLayout()        ->createBlock('core/text', 'example-block3')        ->setText('clicca <a href="http://www.livehelp.it/index.asp?lingua=EN" target="blank">qui</a> per andare sul sito livehelp');		$this->_addContent($block3);		*/				$html='		<div style="position:relative; width:550px; height:450px;margin-left:20%">		<table border="0">  <tr>    <td><h1>What is LiveHelp速?</h1>				<span class="verde15">LiveHelp速</span>  is the <span style="font-weight:700; ">customer care service</span> easy to use and to integrate.<br><br>				Website visitors can chat with an agent of your customer care service and get information about products and services in real time. Only one click to get in contact with a trusted reference.	</td>    <td rowspan="3"><img src="http://www.livehelp.it/vedit/15/img/business-opportunity.png"></td>  </tr>  <tr>    <td>				<div style="width:550px">				<h1>How it works</h1>				Generate the button with the widget and <span style="font-weight:700; ">get ready to chat with your users!</span><br><br> 				<span style="font-weight:700; ">Agents</span> log into the operator\'s client from a custom URL, using their personal username and password. <br>				<span style="font-weight:700; ">Users</span> invite operators to chat in a private browser window by clicking the LiveHelp速 button or text you put into your website.</br>				<span style="font-weight:700; ">Agents receive a sound alert</span> (customizable in the administrator panel) and a desktop notification on their monitors, from which they can accept the chat.	<br></td>  </tr>  <tr>    <td><a href="'.$url.'" target="blank"><button>Agent\'s login</button></a>	<a href="http://server.livehelp.it/admin/main.asp" target="blank"><button>Dashboard</button></a>	<a href="http://www.livehelp.it/index.asp?lingua=EN" target="blank"><button>Go to Livehelp site</button></a>	<a href="http://www.livehelp.it/magento/livehelp_magento_guide.pdf" target="blank"><button>Download the manual</button></a></td>  </tr></table>				</div>				';		$block4 = $this->getLayout()        ->createBlock('core/text', 'example-block4')        ->setText($html);		$this->_addContent($block4);		        $this->renderLayout();    }}